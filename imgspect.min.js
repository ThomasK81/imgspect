(function(b){function c(a,b,e){this.elem=a;this.id=e;this.init(a,b)}c.prototype.init=function(a,d){this.colors={YELLOW:"#FFFF00",MAGENTA:"#FF00FF",CYAN:"#00FFFF"};this.options=b.extend({zoom_unit:0.1,lite_color:new Culuh(this.colors.YELLOW),lite_opacity:0.4,secs:0.5,load:null,info:null},d);this.events={change:"IMGSPECT-CHANGE",undo:"IMGSPECT-UNDO",error:"IMGSPECT-ERROR",update:"IMGSPECT-UPDATE",ready:"IMGSPECT-READY"};this.lites=[];this.imgbits=[];this.zoom_n=1;this.zoom_shift=null;this.pan={x:0,
y:0};this.c_lite=null;this.orig_w=b(this.elem).width();this.orig_h=b(this.elem).height();this.nav_scale=1;this.dragDiff={top:0,left:0};this.src=null;this.build();this.resize();this.outputBuild();this.start();null!=this.options.load&&this.load(this.options.load);b(this.elem).trigger(this.events.ready)};c.prototype.toJsonLD=function(){for(var a=[],b=0,e=this.imgbits.length;b<e;b++)a[b]=this.imgbits[b].toJsonLD(this.options.info);return a};c.prototype.dump=function(){console.log(this)};c.prototype.build=
function(){b(this.elem).wrap('<div class="imgspect">');this.elem=b(this.elem).parent();b("img",this.elem).wrap('<div class="nav">');b(".nav",this.elem).prepend('<div class="drag">');b(".nav",this.elem).wrap('<div class="ui">');b(".ui",this.elem).wrap('<div class="center">');b(this.elem).prepend('<div class="view">');b(".view",this.elem).prepend('<div class="draw">');this.src=b(".nav img",this.elem).attr("src");b(".draw",this.elem).css({"background-image":"url('"+this.src+"')"});this.toolsBuild();
this.dropBuild();b(this.elem).append('<div style="clear:both">')};c.prototype.toolsBuild=function(){b(".ui",this.elem).append('<div class="tools">');b(".tools",this.elem).append('\t\t\t\t<a href="#" class="tool zoom in">+</a>\t\t\t\t<a href="#" class="tool zoom out">-</a>\t\t ');b(".tools",this.elem).append('<div class="colors">');for(var a in this.colors){var d=a.toLowerCase();b(".colors",this.elem).append('<a href="#" class="tool color '+d+'">&nbsp;<a>');b(".color."+d,this.elem).css({"background-color":this.colors[a]})}b(".tools",
this.elem).append('<a href="#" class="tool undo">&larr;</a>');b(".tools",this.elem).append('<div style="clear:both">')};c.prototype.dropBuild=function(){b(this.elem).before('\t\t\t<div id="drop">\t\t\t\t<div class="sortBits">\t\t\t\t\t<a href="" id="time" class="sort">Time</a>\t\t\t\t\t<a href="" id="space" class="sort">Space</a>\t\t\t\t</div>\t\t\t\t<div class="imgbits"></div>\t\t\t</div>'.smoosh());b("#drop .sortBits").hide();this.drop=b("#drop").menumucil({cover:!0,closed:"&#9660",open:"&#9650"}).data("#drop");
this.dropStart()};c.prototype.dropCount=function(){var a=this.lites.length;b("#drop .extra").text(a)};c.prototype.dropStart=function(){var a=this;b(a.elem).on(a.events.change,function(b){b=a.liteLast().id;a.imgbitAdd(b);a.dropCount()});b("#drop .sort").on("touchstart click",function(d){d.stopPropagatin();d.preventDefault();d=b(this).attr("id");a.imgbitsSort(d)})};c.prototype.imgbitAdd=function(a){var d=this.liteToImgbit(a);b("#drop .imgbits").append(d);d="#drop #imgbit-"+a;this.imgbits.push(b(d).imgbit().data(d));
this.imgbitStart(a)};c.prototype.imgbitsSort=function(a){a=void 0==a?"time":a;var b=new TimeStamp;switch(a){case "time":a=0;for(var e=this.imgbits.length;a<e;a++)b.toUnix(this.imgbits[a].timeCreated);break;case "space":(new Sorted).areaSort(this.imgbits,"param.x1","param.y1","param.y2")}};c.prototype.imgbitRemove=function(a,d){try{if(0>a||a>=this.imgbits.length)throw"out of range";}catch(e){b(this.elem).trigger(this.events.error,{error:e});return}this.imgbits[a].remove();this.imgbits.splice(a,1);
for(var c=0,g=this.imgbits.length;c<g;c++)this.imgbits[c].idUpdate("imgbit-"+c),this.imgbits[c].elem.off("IMGBIT-CHANGE"),this.imgbits[c].elem.off("IMGBIT-CLOSED"),this.imgbitStart(c);this.dropCount()};c.prototype.imgbitStart=function(a){var d=this;b("#drop #imgbit-"+a+" .view").on("touchstart click",function(a){a.stopPropagation();a.preventDefault();d.drop.close();a=b(this).parent().attr("id");var c=parseInt(a.replace("imgbit-",""));setTimeout(function(){d.liteShow(c)},500)});b("#drop #imgbit-"+
a).on("IMGBIT-CHANGE",function(){d.outputUpdate()});b("#drop #imgbit-"+a).on("IMGBIT-CLOSED",function(){d.liteRemove(a)})};c.prototype.outputBuild=function(){b(".tools",this.elem).append('<textarea readonly="readonly" id="imgspectOut" class="output"></textarea>');b(".output",this.elem).css({"max-height":b(".nav",this.elem).innerHeight()-b(".tool",this.elem).outerHeight()});this.outputInitText()};c.prototype.outputInitText=function(){b(".output",this.elem).val("WELCOME TO IMGSPECT \n------------------- \nImgspect is a tool for captioning or transcribing select areas of large images.\n\nUnique identifiers for your captioned areas will be written to this output window once you begin. \n\n\nHOW TO USE IMGSPECT \n------------------- \nDrag the see-through white rectangle over the area of the smaller image you want to inspect. \n\nClick and drag your mouse over the larger image to highlight areas you're interested in. \n\nClick the color squares to change the highlight color. \n\nClick the plus and minus buttons to zoom the larger image in and out. \n\nClick the back-arrow to remove the last highlight. \n\nClick the triangle to open a drop-down of just your highlighted areas. \n\nIn the drop-down view click the hash tag to caption or transcribe the highlighted area.\n\nIn the drop-down view click an img to find its original position in the larger image.\n\n".trim())};
c.prototype.outputUpdate=function(){b(".output",this.elem).val("");for(var a="",d=0,c=this.imgbits.length;d<c;d++)a+=this.imgbits[d].html()+"\n";b(".output",this.elem).val(a);b(this.elem).trigger(this.events.update)};c.prototype.resize=function(){this.navResize();this.viewResize();this.drawResize();this.dragResize();this.liteResize()};c.prototype.dragNavDiff=function(){var a=b(".nav .drag",this.elem).offset().left,d=b(".nav",this.elem).offset().left,c=b(".nav .drag",this.elem).offset().top,f=b(".nav",
this.elem).offset().top;this.dragDiff.left=a-d;this.dragDiff.top=c-f};c.prototype.start=function(){this.zoomStart();this.undoStart();this.liteStart();this.dragStart();this.sizeStart();this.colorStart()};c.prototype.colorStart=function(){var a=this;b(".color:first",a.elem).addClass("selected");b(".color",a.elem).on("touchstart click",function(d){d.stopPropagation();d.preventDefault();b(".color",a.elem).removeClass("selected");b(this).addClass("selected");a.liteColor(b(this).css("background-color"))})};
c.prototype.undoStart=function(){var a=this;b(".undo",a.elem).on("touchstart click",function(b){b.stopPropagation();b.preventDefault();a.liteRemove(a.lites.length-1)})};c.prototype.liteRemove=function(a){try{if(0>a||a>=this.imgbits.length)throw"out of range";}catch(d){b(this.elem).trigger(this.events.error,{error:d});return}var c=this.lites.splice(a,1);this.imgbitRemove(a);this.liteRedraw();b(".nav .lite:eq("+a+")",this.elem).remove();b(this.elem).trigger(this.events.undo,{id:c.id});this.outputUpdate()};
c.prototype.sizeStart=function(){var a=this,d;b(window).resize(function(){d&&clearTimeout(d);d=setTimeout(function(){a.resize()},10)})};c.prototype.drawMouseDown=function(a){this.c_lite=b(document.createElement("div")).addClass("lite");b(".draw",this.elem).append(this.c_lite);a=this.viewMousePos(a);var d=b(".draw",this.elem).position();this.c_pos={left:a.left-d.left,top:a.top-d.top};this.c_lite.css({left:this.c_pos.left,top:this.c_pos.top,"background-color":"#"+this.options.lite_color.hex(),opacity:this.options.lite_opacity})};
c.prototype.drawMouseMove=function(a){if(null!=this.c_lite){var d=this.c_pos;a=this.viewMousePos(a);var c=b(".draw",this.elem).position();a.left-=c.left;a.top-=c.top;d.left>a.left?this.c_lite.css({left:a.left,width:d.left-a.left}):this.c_lite.css({left:d.left,width:a.left-d.left});d.top>a.top?this.c_lite.css({top:a.top,height:d.top-a.top}):this.c_lite.css({top:d.top,height:a.top-d.top})}};c.prototype.drawMouseUp=function(a){if(null!=this.c_lite)if(0==this.c_lite.width()||0==this.c_lite.height())this.c_lite=
null;else{var b=this.c_lite.position();a=b.left/this.zoom_n;var b=b.top/this.zoom_n,c=a+this.c_lite.width()/this.zoom_n,f=b+this.c_lite.height()/this.zoom_n;this.liteAdd(a,b,c,f)}};c.prototype.liteStart=function(){var a=this;b(".view",a.elem).mousedown(function(b){b.preventDefault();a.drawMouseDown(b)});b(".view",a.elem).bind("touchstart",function(b){b.preventDefault();a.drawMouseDown(b)});b(".view",a.elem).mousemove(function(b){b.preventDefault();a.drawMouseMove(b)});b(".view",a.elem).bind("touchmove",
function(b){b.preventDefault();a.drawMouseMove(b)});b(a.elem).mouseup(function(b){b.preventDefault();a.drawMouseUp(b)});b(a.elem).bind("touchend",function(b){b.preventDefault();a.drawMouseUp(b)})};c.prototype.liteAdd=function(a,d,c,f){this.lites.push({x1:parseInt(a),y1:parseInt(d),x2:parseInt(c),y2:parseInt(f),zoom:this.zoom_n,color:this.options.lite_color,opacity:this.options.lite_opacity,id:this.lites.length});this.navLiteDraw(this.liteLast().id);this.c_pos=this.c_lite=null;b(this.elem).trigger(this.events.change)};
c.prototype.liteDom=function(){return b(document.createElement("div")).addClass("lite")};c.prototype.navLiteDraw=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(d){b(this.elem).trigger(this.events.error,{error:d});return}var c=this.liteDom(),f=b(".nav",this.elem);f.append(c);f=f.position();a=this.lites[a];c.css({left:a.x1/this.nav_scale+f.left,top:a.y1/this.nav_scale+f.top,width:a.x2/this.nav_scale-a.x1/this.nav_scale,height:a.y2/this.nav_scale-a.y1/this.nav_scale,"background-color":"#"+
a.color.hex(),opacity:a.opacity})};c.prototype.liteLast=function(){return this.lites[this.lites.length-1]};c.prototype.liteResize=function(){this.liteRedraw()};c.prototype.liteShow=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(d){b(this.elem).trigger(this.events.error,{error:d});return}var c=this.lites[a];a=c.x1+(c.x2-c.x1)/2;c=c.y1+(c.y2-c.y1)/2;a-=b(".view",this.elem).width()/2/this.zoom_n;c-=b(".view",this.elem).height()/2/this.zoom_n;this.goTo(a,c)};c.prototype.liteRedraw=
function(){b(".draw .lite",this.elem).remove();b(".draw",this.elem).position();for(var a=0,c=this.lites.length;a<c;a++){var e=this.liteDom();b(".draw").append(e);e.css({left:this.lites[a].x1*this.zoom_n,top:this.lites[a].y1*this.zoom_n,width:(this.lites[a].x2-this.lites[a].x1)*this.zoom_n,height:(this.lites[a].y2-this.lites[a].y1)*this.zoom_n,"background-color":"#"+this.lites[a].color.hex(),opacity:this.lites[a].opacity})}};c.prototype.navLiteClear=function(){b(".nav .lite",this.elem).remove()};c.prototype.navLiteRedraw=
function(){this.navLiteClear();for(var a=0,b=this.lites.length;a<b;a++)this.navLiteDraw(a)};c.prototype.liteColor=function(a){a=a.toUpperCase();this.options.lite_color=a in this.colors?new Culuh(this.colors[a]):new Culuh(a)};c.prototype.liteToImgbit=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(c){b(this.elem).trigger(this.events.error,{error:c});return}var e=this.lites[a],f=e.color,g=-1==this.src.indexOf("?")?"?":"&";return('<a id="imgbit-'+a+'" class="imgbit edit closable" href="'+
this.src+"\t\t\t\t"+g+"imgbit=\t\t\t\tx1="+e.x1+"\t\t\t\t%y1="+e.y1+"\t\t\t\t%x2="+e.x2+"\t\t\t\t%y2="+e.y2+"\t\t\t\t%c="+f.sat(0.5,!0).hex()+'\t\t\t\t">#</a>').smoosh()};c.prototype.zoomStart=function(){var a=this;b(".zoom",a.elem).on("touchstart click",function(c){c.stopPropagation();c.preventDefault();b(this).hasClass("in")?a.zoomIn():a.zoomOut()})};c.prototype.zoomIn=function(){this.zoom("IN")};c.prototype.zoomOut=function(){this.zoom("OUT")};c.prototype.zoom=function(a){var c=this.zoom_n;switch(a.toUpperCase()){case "IN":this.zoom_n+=
this.options.zoom_unit;break;case "OUT":this.zoom_n-=this.options.zoom_unit}a=b(".draw",this.elem).position().top;var e=b(".draw",this.elem).position().left;a=a/c-a/this.zoom_n;e=e/c-e/this.zoom_n;this.zoom_shift={top:a,left:e};this.resize()};c.prototype.dragStart=function(){var a=this;b(".drag",a.elem).draggable({containment:"parent",scroll:!1,drag:function(){a.drawResize()},stop:function(){a.dragNavDiff()}});var c=b(".nav",this.elem).offset();b(".drag",a.elem).css({left:c.left,top:c.top})};c.prototype.dragHandler=
function(a,b){this.drawMove(-1*(b.left-a.left)*this.zoom_n*this.nav_scale,-1*(b.top-a.top)*this.zoom_n*this.nav_scale)};c.prototype.dragResize=function(){var a=b(".view",this.elem),c=b(".draw",this.elem),e=a.width()/c.width(),e=1<e?1:e,a=a.height()/c.height(),a=1<a?1:a,c=b(".nav img",this.elem),e=c.width()*e,a=c.height()*a,c=b(".nav",this.elem).offset().left,f=b(".nav",this.elem).offset().top;b(".drag",this.elem).css({width:e,height:a,left:c+this.dragDiff.left,top:f+this.dragDiff.top});this.zoom_shift=
null};c.prototype.drawMove=function(a,c){b(".draw",this.elem).css({left:a,top:c})};c.prototype.drawResize=function(){b(".draw",this.elem).css({width:this.orig_w*this.zoom_n,height:this.orig_h*this.zoom_n});var a=b(".nav",this.elem).position(),c=b(".drag",this.elem).position();this.dragHandler(a,c)};c.prototype.navResize=function(){var a=b(".nav",this.elem).height();this.nav_scale=this.orig_h/a;b(".nav img",this.elem).css({height:a});this.navLiteRedraw()};c.prototype.viewResize=function(){var a=b(this.elem).width();
b(".view",this.elem).css({width:a})};c.prototype.viewMousePos=function(a){var c=b(".view",this.elem).position(),e=(void 0!=a.clientX?a.clientX:a.originalEvent.pageX)-c.left;a=(void 0!=a.clientY?a.clientY:a.originalEvent.pageY)-c.top+b(window).scrollTop();return{left:e,top:a}};c.prototype.goTo=function(a,c,e){var f=this;a=void 0==a?0:a;c=void 0==c?0:c;e=void 0==e?f.options.secs:e;var g=b(".nav",this.elem).position(),h=b(".nav",this.elem).width(),k=b(".nav",this.elem).height(),l=b(".drag",this.elem).width(),
m=b(".drag",this.elem).height();a=a/f.nav_scale+g.left;c=c/f.nav_scale+g.top;a=a<g.left?g.left:a;c=c<g.top?g.top:c;h=g.left+h-l;k=g.top+k-m;a=a>h?h:a;c=c>k?k:c;b(".drag",f.elem).animate({left:a,top:c},{duration:1E3*e,step:function(){var a=b(".drag",this.elem).position();f.dragHandler(g,a)}})};c.prototype.load=function(a){};c.prototype["export"]=function(){};jQuery(document).ready(function(a){jQuery.fn.imgspect=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,b,
new c(this,a,b))})}})})(jQuery);
(function(b){function c(a,b,c){this.elem=a;this.id=c;this.init(a,b)}c.prototype.init=function(a,c){this.options=b.extend({style:"full",closable:!1},c);this.events={change:"IMGBIT-CHANGE",closed:"IMGBIT-CLOSED"};this.original=b(this.elem).myHtml();this.href=b(this.elem).attr("href");this.caption=b(this.elem).text();this.imgHeight=this.imgWidth=null;this.timeCreated=(new TimeStamp).withUtc(!0);var e=this.href.split("imgbit=");this.src=e[0].substring(0,e[0].length-1);this.param=this.getToJson(e[1]);
void 0!=this.param.w&&(this.param.z=this.param.w/(this.param.x2-this.param.x1));void 0!=this.param.h&&(this.param.z=this.param.h/(this.param.y2-this.param.y1));void 0!=this.param.c&&(this.culuh=new Culuh(this.param.c));this.param.z=void 0==this.param.z?1:this.param.z;b(this.elem).hasClass("min")&&(this.options.style=null);b(this.elem).hasClass("edit")&&(this.options.style="edit");b(this.elem).hasClass("closable")&&(this.options.closable=!0);this.build()};c.prototype.build=function(){var a=this,c=
b(a.elem).attr("id");b(a.elem).after('<div class="imgbit">');a.elem=b(a.elem).next();b(a.elem).attr("id",c);var c=b(a.elem).prev(),e=c.html();c.remove();null!=a.options.style&&b(a.elem).addClass(a.options.style);b(a.elem).append('<div class="view">');null!=a.options.style&&b(a.elem).append('<div class="text">'+e+"</div>");var f=new Image;f.onload=function(){b(this).addClass("star");a.imgWidth=f.width;a.imgHeight=f.height;b(".view",a.elem).append(this);a.viewCrop();a.imgMove();b(a.elem).prepend('<div style="clear:both"></div>');
null!=a.options.style&&"edit"!=a.options.style&&b(a.elem).prepend('<a class="source" href="'+a.src+'">source</a>');b(a.elem).css({width:b(".view",a.elem).width()});a.editStart();!0==a.options.closable&&a.closeBuild();void 0!=a.param.c&&(b(a.elem).css({"background-color":"#"+a.param.c}),b(".close",a.elem).css({"background-color":"#"+a.param.c}));b(a.elem).trigger(a.events.change)};f.src=a.src};c.prototype.closeBuild=function(){var a=this;b(a.elem).prepend('<a href="" class="close">x</a>');b(".close",
a.elem).click(function(c){b(a.elem).trigger(a.events.closed);b(a.elem).trigger(a.events.change);c.preventDefault()})};c.prototype.captionResize=function(){var a=b(".text",this.elem),c=!1;!1==a.is(":visible")&&(c=!0);a.show();var e=a.height();!0==c&&a.hide();a=parseInt(a.css("font-size").replace("px",""));e=e>a?e:a;b(".caption",this.elem).height(e)};c.prototype.editStart=function(){var a=this;"edit"==a.options.style&&(a.editBuild(),a.captionResize(),b(".caption",a.elem).keypress(function(b){13==b.which&&
a.editSwitch()}),b(".caption",a.elem).bind("input propertychange",function(){a.setCaption(b(".caption",a.elem).val())}))};c.prototype.remove=function(){b(this.elem).remove()};c.prototype.setCaption=function(a){this.caption=a;b(".text",this.elem).text(this.caption);this.captionResize();b(this.elem).trigger(this.events.change)};c.prototype.idUpdate=function(a){b(this.elem).attr("id",a)};c.prototype.editBuild=function(){var a=this,c='<textarea class="caption">'+b(".text",a.elem).text()+"</textarea>";
b(".text",a.elem).after(c);b(".caption",a.elem).css({width:b(".view",a.elem).width()});void 0!=a.culuh&&b(".caption",a.elem).css({"background-color":a.culuh.sat(0.35,!0).hex()});b(".caption",a.elem).hide();b(".text",a.elem).click(function(b){a.editSwitch();b.preventDefault()})};c.prototype.editSwitch=function(){b(".caption",this.elem).is(":visible")?this.editHide():(c.prototype.editHide(),this.editShow())};c.prototype.editHide=function(){b(".caption",this.elem).hide();b(".text",this.elem).show()};
c.prototype.editShow=function(){b(".text",this.elem).hide();b(".caption",this.elem).show();b(".caption",this.elem).cursorToEnd()};c.prototype.viewCrop=function(){b(".view",this.elem).css({width:(this.param.x2-this.param.x1)*this.param.z,height:(this.param.y2-this.param.y1)*this.param.z})};c.prototype.imgMove=function(){b("img.star",this.elem).css({width:b("img.star",this.elem).width()*this.param.z,height:b("img.star",this.elem).height()*this.param.z,left:-1*this.param.x1*this.param.z,top:-1*this.param.y1*
this.param.z})};c.prototype.getToJson=function(a){if(""==a)return{};var b={};a=a.split("%");for(var c=0,f=a.length;c<f;c++){var g=a[c].split("=");2==g.length&&(b[g[0]]=decodeURIComponent(g[1].replace(/\+/g,"")))}return b};c.prototype.html=function(){var a=-1==this.src.indexOf("?")?"?":"&";return('<a class="imgbit" \t\t\t\t\t\thref="'+this.src+"\t\t\t\t\t\t"+a+"imgbit=\t\t\t\t\t\tx1="+this.param.x1+"\t\t\t\t\t\t%y1="+this.param.y1+"\t\t\t\t\t\t%x2="+this.param.x2+"\t\t\t\t\t\t%y2="+this.param.y2+"\t\t\t\t\t\t%c="+
this.param.c+"\t\t\t\t\t\t%z="+this.param.z+'">\t\t\t\t\t\t'+this.caption+"\t\t\t\t\t<a>").smoosh()};c.prototype.citeCoords=function(){var a=[];a[0]=this.param.x1/this.imgWidth;a[1]=this.param.y1/this.imgHeight;a[2]=(this.param.x2-this.param.x1)/this.imgWidth;a[3]=(this.param.y2-this.param.y1)/this.imgHeight;for(var b=0,c=a.length;b<c;b++)a[b]=a[b].toFixed(4);return a};c.prototype.toJsonLD=function(a){return{"@context":"http://www.w3.org/ns/oa-context-20130208.json","@type":"oa:Annotation",annotatedAt:this.timeCreated,
annotatedBy:{"@type":"foaf:Person"},motivatedBy:"perseus:transcribing",label:"isQuotationOf"}};jQuery(document).ready(function(a){jQuery.fn.imgbit=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,b,new c(this,a,b))})}})})(jQuery);jQuery.fn.cursorToEnd=function(){return this.each(function(){$(this).focus();if(this.setSelectionRange){var b=2*$(this).val().length;this.setSelectionRange(b,b)}else $(this).val($(this).val());this.scrollTop=999999})};
jQuery.fn.myHtml=function(){return $(this).clone().wrap("<div>").parent().html()};jQuery.fn.transLength=function(){var b=$(this).css("transition").match(/ [\d|\.]+s/g);return 1E3*Number(b[0].replace("s",""))};String.prototype.smoosh=function(){return this.replace(/(\r\n+|\n+|\r+|\t+)/gm,"")};String.prototype.occurs=function(b,c){if(void 0==b)return this.length;b+="";if(0>=b.length)return this.length;for(var a=0,d=0,e=c?1:b.length;;)if(d=this.indexOf(b,d),0<=d)a++,d+=e;else break;return a};
String.prototype.params=function(){for(var b=this.split("?"),b=b[1].split("&"),c={},a=0,d=b.length;a<d;a++)if(void 0!=b[a]){var e=b[a].split("=");c[e[0]]=e[1]}return c};String.prototype.hasUpper=function(){return/[A-Z]/.test(this)};String.prototype.report=function(){for(var b=this.toLowerCase().split(" "),c={},a=0,d=b.length;a<d;a++){var e=b[a];c[e]=e in c?c[e]+1:1}return c};String.prototype.lines=function(){return this.split("\n")};
String.prototype.sentences=function(){for(var b=this.match(/[^\.!\?]+[\.!\?]+/g),c="aeiouy".split(""),a=[],d="",e=0;e<b.length;e++){for(var f=d+b[e],d="",g=!0,h=0;h<c.length;h++)if(-1!=f.indexOf(c[h])){g=!1;break}f.trim()[0].hasUpper()||(g=!0);g?0<a.length?a[a.length-1]+=f:d=f:a.push(f.smoosh().trim())}return a};function TimeStamp(){}
TimeStamp.prototype.withUtc=function(b){var c=new Date,a=c.getFullYear(),d=("0"+(c.getMonth()+1)).slice(-2),e=("0"+c.getDate()).slice(-2),f=c.getHours(),g=("0"+c.getMinutes()).slice(-2),h=("0"+c.getSeconds()).slice(-2),k=("0"+c.getMilliseconds()).slice(-3),c=c.getTimezoneOffset(),l="",l=b?a+"-"+d+"-"+e+"T"+f+":"+g+":"+h+":"+k+"UTC":a+"-"+d+"-"+e+"T"+f+":"+g+":"+h+"UTC";return 0<c?l+"+"+c:l+"-"+c};TimeStamp.prototype.unix=function(){return(new Date).getTime()};
TimeStamp.prototype.toUnix=function(b){b=b.replace(/UTC.*/,"");var c=0;b.match(/:\d{3}/)&&(c=b.slice(-4),b=b.replace(/:\d+$/,""),c=parseInt(c.replace(":","")));return Date.parse(b).getTime()+c};function Culuh(b){this.v=this.s=this.h=this.b=this.g=this.r=0;void 0!=b&&(this.original=b,this.reset(),this.hsvUpdate())}
Culuh.prototype.reset=function(){var b=this.original,b=b.toUpperCase();-1<b.indexOf("RGB")?(b=b.match(/\d+\.?\d*/g),this.r=parseInt(b[0]),this.g=parseInt(b[1]),this.b=parseInt(b[2])):(b=b.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i),this.r=this.hexToInt(b[1]),this.g=this.hexToInt(b[2]),this.b=this.hexToInt(b[3]))};
Culuh.prototype.hsvUpdate=function(){var b,c;b=this.r/255;var a=this.g/255,d=this.b/255;c=Math.min(b,a,d);var e=Math.max(b,a,d),f=e-c;c=0==e?0:f/e;0==c?b=0:(b=b==e?(a-d)/f:a==e?2+(d-b)/f:4+(b-a)/f,isNaN(b)&&(b=0),b/=6,0>b&&b++);this.h=255*b;this.s=255*c;this.v=255*e};
Culuh.prototype.rgbUpdate=function(){var b,c,a,d=this.h/255,e=this.s/255,f=this.v/255;if(0==e)b=c=a=f;else{var d=6*d,g=d%1,h=f*(1-e),k=f*(1-e*g),e=f*(1-e*(1-g));switch(Math.floor(d)){case 0:b=f;c=e;a=h;break;case 1:b=k;c=f;a=h;break;case 2:b=h;c=f;a=e;break;case 3:b=h;c=k;a=f;break;case 4:b=e;c=h;a=f;break;case 5:b=f,c=h,a=k}}this.r=parseInt(255*b);this.g=parseInt(255*c);this.b=parseInt(255*a)};Culuh.prototype.hex=function(b){return(void 0==b?"":b)+this.rHex()+this.gHex()+this.bHex()};
Culuh.prototype.rgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"};Culuh.prototype.rHex=function(){return this.intToHex(this.r)};Culuh.prototype.gHex=function(){return this.intToHex(this.g)};Culuh.prototype.bHex=function(){return this.intToHex(this.b)};Culuh.prototype.rInt=function(){return this.r};Culuh.prototype.gInt=function(){return this.g};Culuh.prototype.bInt=function(){return this.b};Culuh.prototype.hexToInt=function(b){return parseInt(b,16)};
Culuh.prototype.intToHex=function(b){b=b.toString(16);2>b.length&&(b="0"+b);return b.toUpperCase()};Culuh.prototype.sat=function(b,c){var a=this.s,a=a*b;if(!0!=c)this.s=a,this.rgbUpdate();else return a=new Culuh(this.rgb()),a.sat(b),a};Culuh.prototype.invert=function(b){if(!0!=b)this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.hsvUpdate();else return b=new Culuh(this.rgb()),b.invert(),b};
(function(b){function c(a,b,c){this.elem=a;this.id=c;this.init(a,b)}c.prototype.init=function(a,c){this.options=b.extend({closed:"&#9660;",open:"&#9650;",button_classes:null,up:!1,cover:!1},c);this.events={open:"MENUMUCIL-OPEN",closed:"MENUMUCIL-CLOSED"};this.clicker=this.pane=this.menu=null;this.build()};c.prototype.build=function(){var a=this;a.menu=b(a.elem);a.menu.addClass("menumucil");(a.options.cover||a.options.up)&&a.menu.css({position:"absolute","z-index":5E3});a.menu.wrapInner('<div class="inner" />');
a.menu.wrapInner('<div class="pane" />');a.pane=b(".pane",a.elem);a.pane.addClass("closed");a.clicker=b(document.createElement("a"));a.clicker.attr("href","#");a.clicker.addClass("clicker");null!=a.options.button_classes&&a.clicker.addClass(a.options.button_classes);a.menu.append(a.clicker);a.icon=b(document.createElement("span"));a.icon.addClass("icon");a.clicker.append(a.icon);a.icon.html(a.options.closed);a.extra=b(document.createElement("span"));a.extra.addClass("extra");a.clicker.append(a.extra);
a.pane.on("transitionEnd webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(b){a.pane.hasClass("open")&&a.pane.css("max-height",9999)});if(a.options.cover||a.options.up){var c=a.clicker.height();a.menu.after('<div style="height:'+c+'px;clear:both"></div>')}a.closeNow();b(a.clicker).click(function(b){a.isOpen()?a.close():a.pane.hasClass("closed")&&a.open();b.preventDefault()})};c.prototype.isOpen=function(){return this.pane.hasClass("open")?!0:!1};c.prototype.isClosed=function(){return this.pane.hasClass("closed")?
!0:!1};c.prototype.open=function(){this.pane.contentHeight=this.pane.outerHeight();this.pane.contentHeight+=b(".inner",this.elem).outerHeight();this.pane.css({"max-height":this.pane.contentHeight});this.options.up&&this.menu.css({top:this.menu.position().top-this.pane.contentHeight});this.pane.removeClass("closed");this.pane.addClass("open");this.icon.html(this.options.open);this.pane.trigger(this.events.open,[this.id])};c.prototype.close=function(){var a=this;a.pane.contentHeight=a.pane.outerHeight();
a.pane.removeClass("transitions").css("max-height",a.pane.contentHeight);setTimeout(function(){a.closeNow();a.pane.removeClass("open");a.pane.addClass("closed");a.icon.html(a.options.closed);a.menu.trigger(a.events.closed,[a.id])},10)};c.prototype.closeNow=function(){this.pane.addClass("transitions").css({"max-height":0})};jQuery(document).ready(function(a){jQuery.fn.menumucil=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,b,new c(this,a,b))})}})})(jQuery);

