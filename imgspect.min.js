(function(b){function c(a,b,d){this.elem=a;this.id=d;this.init(a,b)}c.prototype.init=function(a,e){this.colors={YELLOW:"#FFFF00",MAGENTA:"#FF00FF",CYAN:"#00FFFF"};this.options=b.extend({zoom_unit:0.1,lite_color:new Culuh(this.colors.YELLOW),lite_opacity:0.4,secs:0.5,load:null,info:null},e);this.events={change:"IMGSPECT-CHANGE",undo:"IMGSPECT-UNDO",error:"IMGSPECT-ERROR"};this.lites=[];this.imgbits=[];this.zoom_n=1;this.zoom_shift=null;this.pan={x:0,y:0};this.c_lite=null;this.orig_w=b(this.elem).width();
this.orig_h=b(this.elem).height();this.nav_scale=1;this.src=null;this.build();this.resize();this.outputBuild();this.start();null!=this.options.load&&this.load(this.options.load)};c.prototype.toJsonLD=function(){for(var a=[],b=0,d=this.imgbits.length;b<d;b++)a[b]=this.imgbits[b].toJsonLD(this.options.info);return a};c.prototype.dump=function(){console.log(this)};c.prototype.build=function(){b(this.elem).wrap('<div class="imgspect">');this.elem=b(this.elem).parent();b("img",this.elem).wrap('<div class="nav">');
b(".nav",this.elem).prepend('<div class="drag">');b(".nav",this.elem).wrap('<div class="ui">');b(".ui",this.elem).wrap('<div class="center">');b(this.elem).prepend('<div class="view">');b(".view",this.elem).prepend('<div class="draw">');this.src=b(".nav img",this.elem).attr("src");b(".draw",this.elem).css({"background-image":"url('"+this.src+"')"});this.toolsBuild();this.dropBuild();b(this.elem).append('<div style="clear:both">')};c.prototype.toolsBuild=function(){b(".ui",this.elem).prepend('<div class="tools">');
b(".tools",this.elem).append('\t\t\t\t<a href="#" class="tool zoom in">+</a>\t\t\t\t<a href="#" class="tool zoom out">-</a>\t\t ');b(".tools",this.elem).append('<div class="colors">');for(var a in this.colors){var e=a.toLowerCase();b(".colors",this.elem).append('<a href="#" class="tool color '+e+'">&nbsp;<a>');b(".color."+e,this.elem).css({"background-color":this.colors[a]})}b(".tools",this.elem).append('<a href="#" class="tool undo">&larr;</a>');b(".tools",this.elem).append('<div style="clear:both">')};
c.prototype.dropBuild=function(){b(this.elem).before('<div id="drop"><div class="imgbits"></div></div>');this.drop=b("#drop").menumucil({cover:!0,closed:"&#9660",open:"&#9650"}).data("#drop");this.dropStart()};c.prototype.dropCount=function(){var a=this.lites.length;b("#drop .extra").text(a)};c.prototype.dropStart=function(){var a=this;b(a.elem).on(a.events.change,function(b){b=a.liteLast().id;a.imgbitAdd(b);a.dropCount()})};c.prototype.imgbitAdd=function(a){var e=this.liteToImgbit(a);b("#drop .imgbits").append(e);
e="#drop #imgbit-"+a;this.imgbits.push(b(e).imgbit().data(e));this.imgbitStart(a)};c.prototype.imgbitRemove=function(a,e){try{if(0>a||a>=this.imgbits.length)throw"out of range";}catch(d){b(this.elem).trigger(this.events.error,{error:d});return}this.imgbits[a].remove();this.imgbits.splice(a,1);for(var c=0,g=this.imgbits.length;c<g;c++)this.imgbits[c].idUpdate("imgbit-"+c),this.imgbits[c].elem.off("IMGBIT-CHANGE"),this.imgbits[c].elem.off("IMGBIT-CLOSED"),this.imgbitStart(c);this.dropCount()};c.prototype.imgbitStart=
function(a){var e=this;b("#drop #imgbit-"+a+" .view").click(function(a){e.drop.close();var c=b(this).parent().attr("id"),g=parseInt(c.replace("imgbit-",""));setTimeout(function(){spect.liteShow(g)},500);a.preventDefault()});b("#drop #imgbit-"+a).on("IMGBIT-CHANGE",function(){e.outputUpdate()});b("#drop #imgbit-"+a).on("IMGBIT-CLOSED",function(){e.liteRemove(a)})};c.prototype.outputBuild=function(){b(".tools",this.elem).append('<div class="output"><pre></pre></div>');b(".output",this.elem).css({"max-height":b(".nav",
this.elem).innerHeight()-b(".tool",this.elem).outerHeight()});this.outputInitText()};c.prototype.outputInitText=function(){b(".output pre",this.elem).text("WELCOME TO IMGSPECT \n------------------- \nImgspect is a tool for captioning or transcribing select areas of large images.\n\nUnique identifiers for your captioned areas will be written to this output window once you begin. \n\n\nHOW TO USE IMGSPECT \n------------------- \nDrag the see-through white rectangle over the area of the smaller image you want to inspect. \n\nClick and drag your mouse over the larger image to highlight areas you're interested in. \n\nClick the color squares to change the highlight color. \n\nClick the plus and minus buttons to zoom the larger image in and out. \n\nClick the back-arrow to remove the last highlight. \n\nClick the triangle to open a drop-down of just your highlighted areas. \n\nIn the drop-down view click the hash tag to caption or transcribe the highlighted area.\n\nIn the drop-down view click an img to find its original position in the larger image.\n\n".trim())};
c.prototype.outputUpdate=function(){b(".output pre",this.elem).text("");for(var a="",e=0,d=this.imgbits.length;e<d;e++)a+=this.imgbits[e].html()+"\n";b(".output pre",this.elem).text(a)};c.prototype.resize=function(){this.navResize();this.viewResize();this.drawResize();this.dragResize();this.liteResize()};c.prototype.start=function(){this.zoomStart();this.undoStart();this.liteStart();this.dragStart();this.sizeStart();this.colorStart()};c.prototype.colorStart=function(){var a=this;b(".color:first",
a.elem).addClass("selected");b(".color",a.elem).click(function(e){b(".color",a.elem).removeClass("selected");b(this).addClass("selected");a.liteColor(b(this).css("background-color"));e.preventDefault()})};c.prototype.undoStart=function(){var a=this;b(".undo",a.elem).click(function(b){a.liteRemove(a.lites.length-1);b.preventDefault()})};c.prototype.liteRemove=function(a){try{if(0>a||a>=this.imgbits.length)throw"out of range";}catch(e){b(this.elem).trigger(this.events.error,{error:e});return}var d=
this.lites.splice(a,1);this.imgbitRemove(a);this.liteRedraw();b(".nav .lite:eq("+a+")",this.elem).remove();b(this.elem).trigger(this.events.undo,{id:d.id});this.outputUpdate()};c.prototype.sizeStart=function(){var a=this,e;b(window).resize(function(){e&&clearTimeout(e);e=setTimeout(function(){a.resize()},50)})};c.prototype.liteStart=function(){var a=this;b(".view",a.elem).mousedown(function(e){a.c_lite=b(document.createElement("div")).addClass("lite");b(".draw",a.elem).append(a.c_lite);var d=a.viewMousePos(e),
c=b(".draw",a.elem).position();a.c_pos={left:d.left-c.left,top:d.top-c.top};a.c_lite.css({left:a.c_pos.left,top:a.c_pos.top,"background-color":"#"+a.options.lite_color.hex(),opacity:a.options.lite_opacity});e.preventDefault()});b(".view",a.elem).mousemove(function(e){if(null!=a.c_lite){var d=a.c_pos;e=a.viewMousePos(e);var c=b(".draw",a.elem).position();e.left-=c.left;e.top-=c.top;d.left>e.left?a.c_lite.css({left:e.left,width:d.left-e.left}):a.c_lite.css({left:d.left,width:e.left-d.left});d.top>e.top?
a.c_lite.css({top:e.top,height:d.top-e.top}):a.c_lite.css({top:d.top,height:e.top-d.top})}});b(".view",a.elem).mouseup(function(e){if(0==a.c_lite.width()||0==a.c_lite.height())a.c_lite=null;else{var d=a.c_lite.position(),c=d.left/a.zoom_n,d=d.top/a.zoom_n,g=c+a.c_lite.width()/a.zoom_n,h=d+a.c_lite.height()/a.zoom_n;a.lites.push({x1:parseInt(c),y1:parseInt(d),x2:parseInt(g),y2:parseInt(h),zoom:a.zoom_n,color:a.options.lite_color,opacity:a.options.lite_opacity,id:a.lites.length});a.navLiteDraw(a.liteLast().id);
a.c_lite=null;a.c_pos=null;b(a.elem).trigger(a.events.change);e.preventDefault()}})};c.prototype.liteDom=function(){return b(document.createElement("div")).addClass("lite")};c.prototype.navLiteDraw=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(e){b(this.elem).trigger(this.events.error,{error:e});return}var d=this.liteDom(),c=b(".nav",this.elem);c.append(d);c=c.position();a=this.lites[a];d.css({left:a.x1/this.nav_scale+c.left,top:a.y1/this.nav_scale+c.top,width:a.x2/this.nav_scale-
a.x1/this.nav_scale,height:a.y2/this.nav_scale-a.y1/this.nav_scale,"background-color":"#"+a.color.hex(),opacity:a.opacity})};c.prototype.liteLast=function(){return this.lites[this.lites.length-1]};c.prototype.liteResize=function(){this.liteRedraw()};c.prototype.liteShow=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(e){b(this.elem).trigger(this.events.error,{error:e});return}var c=this.lites[a];a=c.x1+(c.x2-c.x1)/2;c=c.y1+(c.y2-c.y1)/2;a-=b(".view",this.elem).width()/2/this.zoom_n;
c-=b(".view",this.elem).height()/2/this.zoom_n;this.goTo(a,c)};c.prototype.liteRedraw=function(){b(".draw .lite",this.elem).remove();b(".draw",this.elem).position();for(var a=0,e=this.lites.length;a<e;a++){var c=this.liteDom();b(".draw").append(c);c.css({left:this.lites[a].x1*this.zoom_n,top:this.lites[a].y1*this.zoom_n,width:(this.lites[a].x2-this.lites[a].x1)*this.zoom_n,height:(this.lites[a].y2-this.lites[a].y1)*this.zoom_n,"background-color":"#"+this.lites[a].color.hex(),opacity:this.lites[a].opacity})}};
c.prototype.navLiteClear=function(){b(".nav .lite",this.elem).remove()};c.prototype.navLiteRedraw=function(){this.navLiteClear();for(var a=0,b=this.lites.length;a<b;a++)this.navLiteDraw(a)};c.prototype.liteColor=function(a){a=a.toUpperCase();this.options.lite_color=a in this.colors?new Culuh(this.colors[a]):new Culuh(a)};c.prototype.liteToImgbit=function(a){try{if(0>a||a>=this.lites.length)throw"out of range";}catch(e){b(this.elem).trigger(this.events.error,{error:e});return}var c=this.lites[a];return('<a id="imgbit-'+
a+'" class="imgbit edit closable" href="'+this.src+"\t\t\t\t?x1="+c.x1+"\t\t\t\t&y1="+c.y1+"\t\t\t\t&x2="+c.x2+"\t\t\t\t&y2="+c.y2+"\t\t\t\t&c="+c.color.sat(0.5,!0).hex()+'\t\t\t\t">#</a>').smoosh()};c.prototype.zoomStart=function(){var a=this;b(".zoom",a.elem).click(function(c){b(this).hasClass("in")?a.zoomIn():a.zoomOut();c.preventDefault()})};c.prototype.zoomIn=function(){this.zoom("IN")};c.prototype.zoomOut=function(){this.zoom("OUT")};c.prototype.zoom=function(a){var c=this.zoom_n;switch(a.toUpperCase()){case "IN":this.zoom_n+=
this.options.zoom_unit;break;case "OUT":this.zoom_n-=this.options.zoom_unit}a=b(".draw",this.elem).position().top;var d=b(".draw",this.elem).position().left;a=a/c-a/this.zoom_n;d=d/c-d/this.zoom_n;this.zoom_shift={top:a,left:d};this.resize()};c.prototype.dragStart=function(){var a=this;b(".drag",a.elem).draggable({containment:"parent",scroll:!1,drag:function(){a.drawResize()}});var c=b(".nav",this.elem).offset();b(".drag",a.elem).css({left:c.left,top:c.top})};c.prototype.dragHandler=function(a,b){this.drawMove(-1*
(b.left-a.left)*this.zoom_n*this.nav_scale,-1*(b.top-a.top)*this.zoom_n*this.nav_scale)};c.prototype.dragResize=function(){var a=b(".view",this.elem),c=b(".draw",this.elem),d=a.width()/c.width(),d=1<d?1:d,a=a.height()/c.height(),a=1<a?1:a,c=b(".nav img",this.elem),d=c.width()*d,a=c.height()*a;b(".drag",this.elem).css({width:d,height:a});this.zoom_shift=null};c.prototype.drawMove=function(a,c){b(".draw",this.elem).css({left:a,top:c})};c.prototype.drawResize=function(){b(".draw",this.elem).css({width:this.orig_w*
this.zoom_n,height:this.orig_h*this.zoom_n});var a=b(".nav",this.elem).position(),c=b(".drag",this.elem).position();this.dragHandler(a,c)};c.prototype.navResize=function(){var a=b(".nav",this.elem).height();this.nav_scale=this.orig_h/a;b(".nav img",this.elem).css({height:a});this.navLiteRedraw()};c.prototype.viewResize=function(){var a=b(this.elem).width();b(".view",this.elem).css({width:a})};c.prototype.viewMousePos=function(a){var c=b(".view",this.elem).position(),d=a.clientX-c.left;a=a.clientY-
c.top+b(window).scrollTop();return{left:d,top:a}};c.prototype.goTo=function(a,c,d){var f=this;a=void 0==a?0:a;c=void 0==c?0:c;d=void 0==d?f.options.secs:d;var g=b(".nav",this.elem).position(),h=b(".nav",this.elem).width(),k=b(".nav",this.elem).height(),l=b(".drag",this.elem).width(),m=b(".drag",this.elem).height();a=a/f.nav_scale+g.left;c=c/f.nav_scale+g.top;a=a<g.left?g.left:a;c=c<g.top?g.top:c;h=g.left+h-l;k=g.top+k-m;a=a>h?h:a;c=c>k?k:c;b(".drag",f.elem).animate({left:a,top:c},{duration:1E3*d,
step:function(){var a=b(".drag",this.elem).position();f.dragHandler(g,a)}})};c.prototype.load=function(a){};c.prototype["export"]=function(){};jQuery(document).ready(function(a){jQuery.fn.imgspect=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,b,new c(this,a,b))})}})})(jQuery);
(function(b){function c(a,b,c){this.elem=a;this.id=c;this.init(a,b)}c.prototype.init=function(a,c){this.options=b.extend({style:"full",closable:!1},c);this.events={change:"IMGBIT-CHANGE",closed:"IMGBIT-CLOSED"};this.original=b(this.elem).myHtml();this.href=b(this.elem).attr("href");this.caption=b(this.elem).text();this.imgHeight=this.imgWidth=null;this.timeCreated=(new TimeStamp).withUtc();var d=this.href.split("?");this.src=d[0];this.param=this.getToJson(d[1]);void 0!=this.param.w&&(this.param.z=
this.param.w/(this.param.x2-this.param.x1));void 0!=this.param.h&&(this.param.z=this.param.h/(this.param.y2-this.param.y1));void 0!=this.param.c&&(this.culuh=new Culuh(this.param.c));this.param.z=void 0==this.param.z?1:this.param.z;b(this.elem).hasClass("min")&&(this.options.style=null);b(this.elem).hasClass("edit")&&(this.options.style="edit");b(this.elem).hasClass("closable")&&(this.options.closable=!0);this.build()};c.prototype.build=function(){var a=this,c=b(a.elem).attr("id");b(a.elem).after('<div class="imgbit">');
a.elem=b(a.elem).next();b(a.elem).attr("id",c);var c=b(a.elem).prev(),d=c.html();c.remove();null!=a.options.style&&b(a.elem).addClass(a.options.style);b(a.elem).append('<div class="view">');null!=a.options.style&&b(a.elem).append('<div class="text">'+d+"</div>");var f=new Image;f.onload=function(){b(this).addClass("star");a.imgWidth=f.width;a.imgHeight=f.height;b(".view",a.elem).append(this);a.viewCrop();a.imgMove();b(a.elem).prepend('<div style="clear:both"></div>');null!=a.options.style&&"edit"!=
a.options.style&&b(a.elem).prepend('<a class="source" href="'+a.src+'">source</a>');b(a.elem).css({width:b(".view",a.elem).width()});a.editStart();!0==a.options.closable&&a.closeBuild();void 0!=a.param.c&&(b(a.elem).css({"background-color":"#"+a.param.c}),b(".close",a.elem).css({"background-color":"#"+a.param.c}));b(a.elem).trigger(a.events.change)};f.src=a.src};c.prototype.closeBuild=function(){var a=this;b(a.elem).prepend('<a href="" class="close">x</a>');b(".close",a.elem).click(function(c){b(a.elem).trigger(a.events.closed);
b(a.elem).trigger(a.events.change);c.preventDefault()})};c.prototype.captionResize=function(){var a=b(".text",this.elem),c=!1;!1==a.is(":visible")&&(c=!0);a.show();var d=a.height();!0==c&&a.hide();a=parseInt(a.css("font-size").replace("px",""));d=d>a?d:a;b(".caption",this.elem).height(d)};c.prototype.editStart=function(){var a=this;"edit"==a.options.style&&(a.editBuild(),a.captionResize(),b(".caption",a.elem).keypress(function(b){13==b.which&&a.editSwitch()}),b(".caption",a.elem).bind("input propertychange",
function(){a.caption=b(".caption",a.elem).val();b(".text",a.elem).text(a.caption);a.captionResize();b(a.elem).trigger(a.events.change)}))};c.prototype.remove=function(){b(this.elem).remove()};c.prototype.idUpdate=function(a){b(this.elem).attr("id",a)};c.prototype.editBuild=function(){var a=this,c='<textarea class="caption">'+b(".text",a.elem).text()+"</textarea>";b(".text",a.elem).after(c);b(".caption",a.elem).css({width:b(".view",a.elem).width()});void 0!=a.culuh&&b(".caption",a.elem).css({"background-color":a.culuh.sat(0.35,
!0).hex()});b(".caption",a.elem).hide();b(".text",a.elem).click(function(b){a.editSwitch();b.preventDefault()})};c.prototype.editSwitch=function(){b(".caption",this.elem).is(":visible")?this.editHide():(c.prototype.editHide(),this.editShow())};c.prototype.editHide=function(){b(".caption",this.elem).hide();b(".text",this.elem).show()};c.prototype.editShow=function(){b(".text",this.elem).hide();b(".caption",this.elem).show();b(".caption",this.elem).cursorToEnd()};c.prototype.viewCrop=function(){b(".view",
this.elem).css({width:(this.param.x2-this.param.x1)*this.param.z,height:(this.param.y2-this.param.y1)*this.param.z})};c.prototype.imgMove=function(){b("img.star",this.elem).css({width:b("img.star",this.elem).width()*this.param.z,height:b("img.star",this.elem).height()*this.param.z,left:-1*this.param.x1*this.param.z,top:-1*this.param.y1*this.param.z})};c.prototype.getToJson=function(a){if(""==a)return{};var b={};a=a.split("&");for(var c=0,f=a.length;c<f;c++){var g=a[c].split("=");2==g.length&&(b[g[0]]=
decodeURIComponent(g[1].replace(/\+/g,"")))}return b};c.prototype.html=function(){return('<a class="imgbit" \t\t\t\t\t\thref="'+this.src+"\t\t\t\t\t\t?x1="+this.param.x1+"\t\t\t\t\t\t&y1="+this.param.y1+"\t\t\t\t\t\t&x2="+this.param.x2+"\t\t\t\t\t\t&y2="+this.param.y2+"\t\t\t\t\t\t&c="+this.param.c+"\t\t\t\t\t\t&z="+this.param.z+'">\t\t\t\t\t\t'+this.caption+"\t\t\t\t\t<a>").smoosh()};c.prototype.citeCoords=function(){var a=[];a[0]=this.param.x1/this.imgWidth;a[1]=this.param.y1/this.imgHeight;a[2]=
(this.param.x2-this.param.x1)/this.imgWidth;a[3]=(this.param.y2-this.param.y1)/this.imgHeight;for(var b=0,c=a.length;b<c;b++)a[b]=a[b].toFixed(5);return a};c.prototype.toJsonLD=function(a){return{"@context":"http://www.w3.org/ns/oa-context-20130208.json","@type":"oa:Annotation",annotatedAt:this.timeCreated,annotatedBy:{"@type":"foaf:Person"},motivatedBy:"perseus:transcribing",label:"isQuotationOf"}};jQuery(document).ready(function(a){jQuery.fn.imgbit=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,
b,new c(this,a,b))})}})})(jQuery);jQuery.fn.cursorToEnd=function(){return this.each(function(){$(this).focus();if(this.setSelectionRange){var b=2*$(this).val().length;this.setSelectionRange(b,b)}else $(this).val($(this).val());this.scrollTop=999999})};jQuery.fn.myHtml=function(){return $(this).clone().wrap("<div>").parent().html()};String.prototype.smoosh=function(){return this.replace(/(\r\n+|\n+|\r+|\t+)/gm,"")};function TimeStamp(){}
TimeStamp.prototype.withUtc=function(){var b=new Date,c=b.getFullYear(),a=("0"+(b.getMonth()+1)).slice(-2),e=("0"+b.getDate()).slice(-2),d=b.getHours(),f=("0"+b.getMinutes()).slice(-2),g=("0"+b.getSeconds()).slice(-2),b=b.getTimezoneOffset(),c=c+"-"+a+"-"+e+"T"+d+":"+f+":"+g+"UTC";return 0<b?c+"+"+b:c+"-"+b};function Culuh(b){this.v=this.s=this.h=this.b=this.g=this.r=0;void 0!=b&&(this.original=b,this.reset(),this.hsvUpdate())}
Culuh.prototype.reset=function(){var b=this.original,b=b.toUpperCase();-1<b.indexOf("RGB")?(b=b.match(/\d+\.?\d*/g),this.r=parseInt(b[0]),this.g=parseInt(b[1]),this.b=parseInt(b[2])):(b=b.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i),this.r=this.hexToInt(b[1]),this.g=this.hexToInt(b[2]),this.b=this.hexToInt(b[3]))};
Culuh.prototype.hsvUpdate=function(){var b,c;b=this.r/255;var a=this.g/255,e=this.b/255;c=Math.min(b,a,e);var d=Math.max(b,a,e),f=d-c;c=0==d?0:f/d;0==c?b=0:(b=b==d?(a-e)/f:a==d?2+(e-b)/f:4+(b-a)/f,isNaN(b)&&(b=0),b/=6,0>b&&b++);this.h=255*b;this.s=255*c;this.v=255*d};
Culuh.prototype.rgbUpdate=function(){var b,c,a,e=this.h/255,d=this.s/255,f=this.v/255;if(0==d)b=c=a=f;else{var e=6*e,g=e%1,h=f*(1-d),k=f*(1-d*g),d=f*(1-d*(1-g));switch(Math.floor(e)){case 0:b=f;c=d;a=h;break;case 1:b=k;c=f;a=h;break;case 2:b=h;c=f;a=d;break;case 3:b=h;c=k;a=f;break;case 4:b=d;c=h;a=f;break;case 5:b=f,c=h,a=k}}this.r=parseInt(255*b);this.g=parseInt(255*c);this.b=parseInt(255*a)};Culuh.prototype.hex=function(b){return(void 0==b?"":b)+this.rHex()+this.gHex()+this.bHex()};
Culuh.prototype.rgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"};Culuh.prototype.rHex=function(){return this.intToHex(this.r)};Culuh.prototype.gHex=function(){return this.intToHex(this.g)};Culuh.prototype.bHex=function(){return this.intToHex(this.b)};Culuh.prototype.rInt=function(){return this.r};Culuh.prototype.gInt=function(){return this.g};Culuh.prototype.bInt=function(){return this.b};Culuh.prototype.hexToInt=function(b){return parseInt(b,16)};
Culuh.prototype.intToHex=function(b){b=b.toString(16);2>b.length&&(b="0"+b);return b.toUpperCase()};Culuh.prototype.sat=function(b,c){var a=this.s,a=a*b;if(!0!=c)this.s=a,this.rgbUpdate();else return a=new Culuh(this.rgb()),a.sat(b),a};Culuh.prototype.invert=function(b){if(!0!=b)this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.hsvUpdate();else return b=new Culuh(this.rgb()),b.invert(),b};
(function(b){function c(a,b,c){this.elem=a;this.id=c;this.init(a,b)}c.prototype.init=function(a,c){this.options=b.extend({closed:"&#9660;",open:"&#9650;",button_classes:null,up:!1,cover:!1},c);this.events={open:"MENUMUCIL-OPEN",closed:"MENUMUCIL-CLOSED"};this.clicker=this.pane=this.menu=null;this.build()};c.prototype.build=function(){var a=this;a.menu=b(a.elem);a.menu.addClass("menumucil");(a.options.cover||a.options.up)&&a.menu.css({position:"absolute","z-index":5E3});a.menu.wrapInner('<div class="inner" />');
a.menu.wrapInner('<div class="pane" />');a.pane=b(".pane",a.elem);a.pane.addClass("closed");a.clicker=b(document.createElement("a"));a.clicker.attr("href","#");a.clicker.addClass("clicker");null!=a.options.button_classes&&a.clicker.addClass(a.options.button_classes);a.menu.append(a.clicker);a.icon=b(document.createElement("span"));a.icon.addClass("icon");a.clicker.append(a.icon);a.icon.html(a.options.closed);a.extra=b(document.createElement("span"));a.extra.addClass("extra");a.clicker.append(a.extra);
a.pane.on("transitionEnd webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(b){a.pane.hasClass("open")&&a.pane.css("max-height",9999)});if(a.options.cover||a.options.up){var c=a.clicker.height();a.menu.after('<div style="height:'+c+'px;clear:both"></div>')}a.closeNow();b(a.clicker).click(function(b){a.isOpen()?a.close():a.pane.hasClass("closed")&&a.open();b.preventDefault()})};c.prototype.isOpen=function(){return this.pane.hasClass("open")?!0:!1};c.prototype.isClosed=function(){return this.pane.hasClass("closed")?
!0:!1};c.prototype.open=function(){this.pane.contentHeight=this.pane.outerHeight();this.pane.contentHeight+=b(".inner",this.elem).outerHeight();this.pane.css({"max-height":this.pane.contentHeight});this.options.up&&this.menu.css({top:this.menu.position().top-this.pane.contentHeight});this.pane.removeClass("closed");this.pane.addClass("open");this.icon.html(this.options.open);this.pane.trigger(this.events.open,[this.id])};c.prototype.close=function(){var a=this;a.pane.contentHeight=a.pane.outerHeight();
a.pane.removeClass("transitions").css("max-height",a.pane.contentHeight);setTimeout(function(){a.closeNow();a.pane.removeClass("open");a.pane.addClass("closed");a.icon.html(a.options.closed);a.menu.trigger(a.events.closed,[a.id])},10)};c.prototype.closeNow=function(){this.pane.addClass("transitions").css({"max-height":0})};jQuery(document).ready(function(a){jQuery.fn.menumucil=function(a){var b=jQuery(this).selector;return this.each(function(){jQuery.data(this,b,new c(this,a,b))})}})})(jQuery);

