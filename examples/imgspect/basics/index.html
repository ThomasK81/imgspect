<html>
<head>
	<link rel="stylesheet" href="../../../third_party/menumucil/css/menumucil.css">
	<link rel="stylesheet" href="../../../css/imgspect.css">
	<link rel="stylesheet" href="../../../css/imgbit.css">
	<style type="text/css">
		body {
			margin: 0;
		}
		#app {
			background-color: #222;
		}
		#menumucil {
			width: 100%;
		}
		#menumucil .inner {
			background-color: rgba( 0, 0, 0, 0.8 );
			padding: 10px;
		}
		#menumucil .inner .imgbit {
			margin: 10px;
		}
		#menumucil .clicker {
			display: block;
			width: 100%;
			text-align: center;
			text-decoration: none;
			background-color: rgba( 25, 25, 25, 0.9 );
			color: #666;
			padding: 5px 0;
		}
	</style>
</head>
<body>
	<div id="app">
		<div id="menumucil"><div id="imgbits"></div></div>
		<img id="bosch" src="../../img/the-garden-of-earthly-delights.jpg" />
	</div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="../../../third_party/menumucil/menumucil.js"></script>
<script src="../../../third_party/slidepop/slidepop.js"></script>
<script src="../../../imgspect.js"></script>
<script src="../../../imgbit.js"></script>
<script type="text/javascript">
	var spect = null;
	$(window).load( function(){
		
		/**
		 * Start menumucil and grab a handler
		 */
		menumucil = $( '#menumucil' ).menumucil({ cover: true }).data( '#menumucil' );
		
		/**
		 * Start imgspect and grab a handler
		 */
		spect = $( '#bosch' ).imgspect().data( '#bosch' );
		
		/**
		 * Undo listener
		 */
		$( '.imgspect' ).on( 'IMGSPECT-UNDO', function( _e, _obj ) {
			$( '#imgbit-'+_obj.id+'.imgbit' ).remove();
		});
		
		/**
		 * Change listener
		 */
		$( '.imgspect' ).on( 'IMGSPECT-CHANGE', function() {
			var lite = spect.liteLast();
			var id = 'imgbit-'+lite.id;
			
			//------------------------------------------------------------
			//  Make the CMY colors pastel so eyes aren't totally damaged.
			//  This needs revision...
			//------------------------------------------------------------
			var color = lite.color.replace('#','').toUpperCase();
			switch ( color ) {
				case '00FFFF':
					color = 'A5FFFF';
					break;
				case 'FF00FF':
					color = 'FFA5FF';
					break;
				case 'FFFF00':
					color = 'FFFFA5';
					break;
			}
			/*
			var elem = '<a id="'+id+'" class="imgbit edit" href="../../img/the-garden-of-earthly-delights.jpg\
				?x1='+lite.x1+'\
				&y1='+lite.y1+'\
				&x2='+lite.x2+'\
				&y2='+lite.y2+'\
				&c='+color+'\
				&w=200\
				">[click to caption]</a>';
			$( '#imgbits' ).append( elem );
			
			//------------------------------------------------------------
			//  Activate imgbit
			//------------------------------------------------------------
			$( '#'+id+'.imgbit' ).imgbit();
			spect.outputUpdate();
			
			//------------------------------------------------------------
			//  Clicking an imgbit will take you to its position in
			//  the original image.
			//------------------------------------------------------------
			$( '#'+id+'.imgbit .view' ).click( function( _e ) {
				var id = $(this).parent().attr('id');
				i = parseInt( id.replace('imgbit-', '' ) );
				spect.liteShow( i );
				_e.preventDefault();
			});
			
			//------------------------------------------------------------
			//  Imgbit caption edit.
			//------------------------------------------------------------
			$( '#'+id+'.imgbit' ).on( 'IMGBIT-CHANGE', function( _e, _id ) {
				spect.outputUpdate();
			});
			*/
		});
	});
</script>
</html>