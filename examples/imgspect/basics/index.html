<html>
<head>
	<link rel="stylesheet" href="../../../third_party/menumucil/css/menumucil.css">
	<link rel="stylesheet" href="../../../css/imgspect.css">
	<link rel="stylesheet" href="../../../css/imgbit.css">
</head>
<body>
	<div id="menumucil"><div id="imgbits"></div></div>
	<img id="bosch" src="../../img/the-garden-of-earthly-delights.jpg" />
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="../../../third_party/menumucil/menumucil.js"></script>
<script src="../../../imgspect.js"></script>
<script src="../../../imgbit.js"></script>
<script type="text/javascript">
	var spect = null;
	$(window).load( function(){
		
		/**
		 * Start menumucil and grab a handler
		 */
		menumucil = $( '#menumucil' ).menumucil({ cover: true }).data( '#menumucil' );
		
		/**
		 * Start imgspect and grab a handler
		 */
		spect = $( '#bosch' ).imgspect().data( '#bosch' );
		
		/**
		 * Undo listener
		 */
		$( '.imgspect' ).on( 'IMGSPECT-UNDO', function( _e, _obj ) {
			$( '#imgbit-'+_obj.id+'.imgbit' ).remove();
		});
		
		/**
		 * Change listener
		 */
		$( '.imgspect' ).on( 'IMGSPECT-CHANGE', function() {
			var lite = spect.liteLast();
			var id = 'imgbit-'+lite.id;
			var elem = '<a id="'+id+'" class="imgbit min" href="../../img/the-garden-of-earthly-delights.jpg\
				?x1='+lite.x1+'\
				&y1='+lite.y1+'\
				&x2='+lite.x2+'\
				&y2='+lite.y2+'\
				&h=200\
				"></a>';
			$( '#imgbits' ).append( elem );
			
			//------------------------------------------------------------
			//  Activate imgbit
			//------------------------------------------------------------
			$( '#'+id+'.imgbit' ).imgbit();
			
			//------------------------------------------------------------
			//  Clicking an imgbit will take you to its position in
			//  the original image.
			//------------------------------------------------------------
			$( '#'+id+'.imgbit' ).click( function( _e ) {
				var id = $(this).attr('id');
				i = parseInt( id.replace('imgbit-', '' ) );
				spect.liteShow( i );
				_e.preventDefault();
			});
		});
	});
</script>
</html>